Neko ProjectⅡ fmgen版(0.83 kai8 VC6b改?ベース)

関連ファイル
	http://nenecchi.kirara.st/
メニューリソースの別フォント(ＭＳ Ｐゴシック)版
	np2f_932.7z
外部音源DLL(V1)セット
	fmdllset.7z

---------- 210717

(F|H)D_CACHE=1,2修正
書き込み最適化(H1/H2)
ステートファイルにイメージファイルの日時を記録できなかったのを修正(F1/F2/H1/H2)

ジョイパッド修正
POVが無い場合の不具合修正
ボタンの入力がダブるのを修正

スクリーンセーバー抑制追加
メニューScreen→Disable Screen Saverで選択します
チェックするとスクリーンセーバーを抑制します

EGC修正

---------- 210622

iniの一部の数値読み込みが異なる場合があったのを修正

iniにXInputID追加
XInput対応のゲームパッドを選択します
-1		使用しない
0～3	指定したデバイスのXInput対応ゲームパッドを選択します
16		自動検索(最初に見つかったデバイスを選択します)
デフォルトは16(自動検索)です
Joystickよりも優先して選択されます
XInputを使用できない場合は従来型を使用するようにします

iniのJOYSTKIDを変更
-1		使用しない
0～15	指定したデバイスのジョイスティックを選択します
16		自動検索(最初に見つかったデバイスを選択します)
デフォルトは16(自動検索)です

使用できるかの確認はメニューDevice→Sound option...で
従来製の場合はUse JoyPad-(1～16)
XInputの場合はUse JoyPad(X)-(1～4)となり
チェックをすることで使用します

左スティックと十字ボタン(POV)で操作可能に変更

np2f_932.dll変更

EGC修正
不具合あるかも

---------- 210527

PC-9801VMモード起動時にメモリカウント表示をしないように回帰(オリジナル準拠)

86PCM修正
200206の調整で不具合が出るソフトがあるらしいのでそれより前のものに戻しました
86PCM (Original)がオリジナルと同等になっていなかったのも直っています

テキスト再描画がされない場合があったのを修正

---------- 210510

np2でCPU LowやPC-9801VMの時にCPUがV30にならなくなっていたのを修正

IDE(CD)修正

iniのENHANCEDにIDEフラグ操作追加(np21/np2sx)
bit11(2048) = 0:通常/1:操作
NECCDM.SYSを組み込む場合やNECCDD.SYSで待ち時間がある場合はフラグを立ててください

---------- 210505(ねね誕)

BIOSの修正(int 1bh)

プログラマブルインターバルタイマ修正

---------- 210426

リセット(ステートロード)でCD情報が一部失われる場合があるのを修正

CDを認識再生できない場合があったのを修正
NECCDD.SYS(17,616)+MSCDEX.EXEで不具合が出る場合PATACD.SYS+SHCDX86(SHSUCDX).COMの組み合わせで試してみてください

iniにFIXEDCPU追加(仮)
仮想マシンのスレッドを実行するCPU(コア/スレッド)を固定します
固定化することでパフォーマンスが上がるかもしれません(まゆつば)
コアとスレッドが同じCPUの場合
FIXEDCPU=b 10	(=2)コア2で実行
1コアが2スレッドのCPUの場合
FIXEDCPU=b 1100	(=12)コア2(2スレッド)で実行
ENHANCEDでマルチスレッド(bit2)にした場合のみ有効です
固定化できない場合は警告表示して通常通りの実行になります
この項目は自動的に作成されません

カレンダ時計修正

---------- 210314

CPUスピード倍率のデフォルトに150%追加
CPUSMENU=50,75,100,150,200,400,800,0と同じになります

FD_CACHE=1の時に書き込みできなかったのを修正

HD_CACHE=1でエラーになったとき0とみなして実行するように変更

起動時にKey Displayがタスクバーにスナップされることがあったのを修正

タイトルバー右クリックのポップアップメニューにWindow Gravity追加(仮)
デフォルトはオンでサブウィンドウがメインウィンドウに枠に磁石のように引っ付きます
オフにすることで引っ付く動作はなくなりますが離れていてもメインウィンドウに相対して動くようになります

Direct3Dのフルスクリーン時に時間表示位置がずれるのを修正

Direct3DまたはStretchのフルスクリーン描画がナノレベルで高速化なの

---------- 210119

iniにHD_CACHE追加
HDイメージファイルのアクセス方法を設定します
HDイメージのアクセスで処理が遅くなる場合数値を増やしてみてください
0	バッファリングしない(デフォルト)
1	アクセス最適化(あまり効果が無いかも)
2	バッファリングする
バッファリングとは
メージファイルの挿入取り出しのタイミングでイメージファイルへのアクセスを行いします(そのタイミングの時に処理の低下が起こる場合があります)
イメージサイズ分のメモリを余分に使います
ファイルが壊れたり書き込みされない可能性があるかもしれなので念の為バックアップを取って試してください
異常終了の場合はイメージが更新されません

フルスクリーンの拡大にn倍角追加
メニュー→Screen→Screen option→FullScreenタブ→ZoomをMultipleにするとフルスクリーン(No change screen resolution)時にディスプレイに収まる最大n倍で拡大します

---------- 201209

iniのENHANCEDにMPU-PC98IIタイプ追加
bit10(1024) = 0:通常/1:オリジナル準拠
データ転送に時間が必要な場合はオリジナル準拠にしてみてください
ただしMPU-PC98II用のソフトでフリーズする場合もあるのでケースバイケースで

ADPCM修正(今度こそ)

---------- 201109

ステートファイル名にフォルダが含まれている場合の不具合修正

---------- 200331

ini変更修正
初期起動でマスターボリューム(M_Volume)が0だったのを修正
初期値の変更
	Sound Rateを22K→55Kに変更
	QFMをオンに変更
	Bufferを500ms→100msに変更

---------- 200229

シームレスマウス(bit8)の時にマウスモードオン→オフでダブルクリックが有効になっていたのを修正

---------- 200220

#を含むファイル名の扱いを変更

PSGをfmgenの音量とより近似に変更

iniのENHANCEDのFM音源線形補間(bit10)廃止

---------- 200215

デバッグウィンドウで自前デバッグ用の表示を追加してたのを削除

一部イメージで認識できない場合があったのを修正

レジュームしてないのにFDLを復元していたのを修正

---------- 200206

マルチスレッド調整

86PCM調整

---------- 200202

起動時DirectInputでない場合にCaps/Kanaの状態を反映していなかったのを修正

ステートロードで現在の86PCMタイプを反映していなかったのを修正

起動した時にメニューが表示されていないと86PCMの項目がないのを修正

---------- 200128

メニューDevice→Soundに86PCM選択追加
起動またはリセットかステートロードされるまで反映されません
ステートデータにはタイプ状態が保存されないのでステートロードする時にタイプに注意しないと再生が変になる可能性があります
86PCM (Original)	オリジナル準拠
86PCM (General)		np2fmgen標準(デフォルト)
86PCM (Specific)	PCM再生中にスキップ(カット)される場合
86PCM (AVSDRV)		AVSDRV.(SYS|EXE)を使う場合
ぱっと見でわかりやすいと思うのでポップアップ形式にはしていません

iniのENHANCEDのPSG別タイプを変更
bit14(16384) = 0:高音質タイプ/1:オリジナル準拠
デフォルトは高音質タイプです

外部音源DLLメニュー選択でFMWait_A/FMWait_Dを即反映していたのを修正

iniのENHANCEDに86PCM別タイプ(bit11)廃止

---------- 200126

メニューDevice→Sound optionのMixerでボリューム最小でMute表示へ変更

リズム音源がミュートできなかったのを修正

マルチスレッド調整
ほんのり高速軽量化してるかもしれません

86PCM調整
特殊な場合を除き基本デフォルトで問題ないと思います
iniに86PCMTYP(隠し)追加
86PCMTYP=0	オリジナル準拠
86PCMTYP=1	np2fmgen標準
86PCMTYP=2	特殊タイプA(PCM再生中にスキップされたり無音が入る場合)
86PCMTYP=3	特殊タイプB(Aでも問題が起きた場合)
この項目は自動的に作成されません
無い場合はENHANCEDの設定に依存します

---------- 190506

zlibを1.2.11に変更

iniのENHANCEDのPSG別タイプ(bit14)をデフォルト1に変更

iniのPriorityをデフォルト1に変更

外部音源DLLでCriticalSectionが有効になっていたのを無効化

---------- 190306

ADPCMに対応している外部音源DLLでADPCMを使うと例外になる場合があったのを修正

ADPCMに対応している外部音源DLLでGetADPCMBufferが存在していない場合SetRegを使ってメモリを書き込むように変更

ステートロード時にMIDIの音色がリセットされるのを修正

---------- 181018

DirectInputの時にレジューム起動で現在のキー(CAPS/かな)状態を優先するように変更

イメージのドラッグ＆ドロップで.hd5|.hd4|.hdb|.dd6|.dd9を追加

---------- 180825

Patのメニュー文字数を16から20へ変更

---------- 180812

ステートロードでHDD(CD)イメージが無い場合にRemoveするのを抑制

---------- 180811

exeと同ドライブ内の別フォルダにある圧縮ステートファイルをドラッグ＆ドロップでロードできなかったのを修正

---------- 180810

iniにstatzlib追加
statzlib=trueで圧縮ステートファイル(.s???.gz)を使えるようにします
通常ステートファイル(.s???)もロードは可能です
この項目は自動的に作成されません

---------- 180621

Tool windowのFDコンボボックスを最新選択したものから表示するように変更

D3D時ウィンドウサイズが切れた場合描画されなかったのを修正
縦400ラインを×2倍で描画する場合ウィンドウのサイズは800必要ですがディスプレイのサイズが768の場合はウィンドウが切れる状態になります
この場合に描画されなかったのをウィンドウサイズで描画するようにします

---------- 180506

PC-9801-999Aを170925版に戻しました

---------- 180429

ステートロードしたときイメージ名表示が変更されていなかったのを修正
通常で新しくイメージをマウントした場合はイメージ名が変わりますがリセットして始めてマウントが有効になります
イメージを変更した状態でステートセーブしてもリセットしていなければ前のイメージがマウントされている状態です
ステートロードした場合はイメージ名がマウント状態です
変更前
Aイメージマウントしてる時にBイメージをマウントしてリセットせずに終了→レジューム起動はBイメージがマウント状態
変更後
Aイメージマウントしてる時にBイメージをマウントしてリセットせずに終了→レジューム起動はAイメージのままになります

---------- 180417

特殊動作モードのキーボード初期化(BIOS)を変更

EGC修正
想定外でのnp2/np21の処理が違うのは元からです

---------- 180325

iniにS_HEIGHT追加
仮想マシンで使用するディスプレイの最大ラインを設定します
480～800(デフォルト480)
30行BIOSで50行使いたい場合は800にしてください
この項目は自動的に作成されません

iniのENHANCEDにIDE/SCSIマウントイメージ名表示追加
bit19(524288) = 0:非表示/1:表示

---------- 180210

DirectInput8に変更

---------- 171026

iniのENHANCEDにマウスチャタリング防止追加
bit18(262144) = 0:オフ/1:オン
マウスカーソルが勝手に動く環境の場合オンにしてみてください

---------- 171010

170925で外部音源が使えなかった場合があったのを修正

iniにFD_CACHE追加
FDイメージファイルのアクセス方法を設定します
FDイメージのアクセスで処理が遅くなる場合数値を増やしてみてください
0	バッファリングしない(デフォルト)
1	アクセス最適化
2	バッファリングする
アクセス最適化とは
なるべくイメージファイルへのアクセスを少なくするようにします
バッファリングとは
メージファイルの挿入取り出しのタイミングでイメージファイルへのアクセスを行いします(そのタイミングの時に処理の低下が起こる場合があります)
2MB～10MB前後のメモリを余分に使います
ファイルが壊れたり書き込みされない可能性があるかもしれなので念の為バックアップを取って試してください
異常終了の場合はイメージが更新されません

---------- 170930

デフォルトPSGで異音が出る場合があるのを修正

PC-9801-999Aのプチノイズ軽減

外部音源でPSGのボリュームが反映されていなかったのを修正

---------- 170925

BIOS修正(int 12h)

リセット(ブート)時のメモリ初期値変更
ホットキーによるHSBブートでは初期化しません

レジューム修正
外部音源のボリュームが反映されていなかったのを修正
VERMOUTHが無音になっていたのを修正

CPU修正
idivでの例外処理を変更
iniのENHANCEDの特殊動作モード(bit16)で一部panicエラーにならない処理に変更

---------- 170915

PC-9801-999を修正

---------- 170816

特殊動作モードのキーボード初期化(BIOS)のキー入力遅延調整

BIOSの修正(int 18h)
480ライン切り替え

HSBのホットキーによるリブート時にhostdrvが使えなくなるのを修正

ADPCM搭載サウンドボードの復帰時の修正(内蔵ADPCM使用時のみ対応)

---------- 167

外部音源DLLでボリュームが0になる場合があったのを修正

BIOSの修正(int 1bh)
2DD対応

---------- 153

複数搭載に対応していない外部音源DLLで音が出ない場合があったのを修正

レジューム時別のサウンドボードを選択して終了して復帰した時にFM音源部が演奏されなかったのを修正
別のサウンドボードを選択していても復帰前の状態で復帰するのはデフォルト動作です
CPUのクロックなどと同じでリセットして初めて有効になります

NFDのST0戻り値の不具合修正

iniのENHANCEDの特殊動作モード(bit16)でキーボード初期化(BIOS)直後のキー入力を遅延するように変更

---------- 151

レジューム時内蔵fmgenの場合幾つかのパートがマスクされてたのを修正

---------- 150

NFDで特殊なフォーマットに書き込むとイメージが破損する場合があったのを修正

---------- 149

CD-ROM検出用修正

---------- 146

モジュールパス外からのステートファイル読み込みの周り修正

IDEコマンド0のpanicエラー除外

PAT別表記が無効になってたのを修正

---------- 142

BEEPが鳴らない場合があったのを修正

---------- 136

メニューDevice→MIDI option...のUse program define file (MIMPI define)のチェック状態を保存するように変更

デバッグモード(Unassemble)のセグメント入力(Ctrl+G)で「セグメント:オフセット」で入力できるように変更
セグメント/オフセットにはレジスタ(ax/bx/cx/dx/si/di/bp/ip/cs/ds/es/ss)も使用できます
0060		セグメント0060h:オフセット0
:1234		現在のセグメント:オフセット1234h
a800:1000	セグメントa800h:オフセット1000h
cs:ip		現在実行位置

ステートロード後のリセットでFM音源が出なくなる事があったのを修正

まだ全体ボリュームが反映されなかった場合があったのを修正

---------- 132

Spark board/86+ちびおとの時ADPCM設定が失敗するソフトがあるのを修正

Spark boardの時key dispの表示をFM6+PSG3+FM6の順に変更

---------- 130

ADPCM修正

レジューム時に全体ボリュームが反映されなかったのを修正

iniのENHANCEDにサウンドスピード連動を追加
bit17(131072) = 0:通常/1:連動
サウンドスピードをCPUスピード倍率やNOWAIT時の速度に連動させます

---------- 128

メモリリーク修正(127)

WSS修正
Linear 16-bit Little Endian対応
AVSDRVに対応

---------- 127

26K+86の時にパンが振れないチャンネルがあったのを修正

リセット時の86PCM初期化不具合修正

---------- 126

フルスクリーン時の画面モード切替の不具合修正

PATに31/81追加
31	直前の条件判定を適用させ1バイト書き換え
81	直前の条件判定を適用させ2バイト書き換え

例) alm.pat
;
;	Patch for Advanced Lord Monarch (FD)
;
;	この場合は条件が合った初回兵のHPがffffが書き込まれお金は常にffffffffになる
#お金MAX&&兵HPMAX
d000c228 1388
d000c2d0 00c8
8000c2d0 ffff	←上の条件が適用される
8000c228 ffff	←上の条件は適用されない(常時実行)
8000c22a ffff	←上の条件は適用されない(常時実行)
;	この場合は条件が合った初回のみ実行される
#お金MAX&&兵HPMAX
d000c228 1388
d000c2d0 00c8
8100c2d0 ffff	←上の条件が適用される
8100c228 ffff	←上の条件が適用される
8100c22a ffff	←上の条件が適用される

PATコードを別表記でも可能に(自分用)
80	ww / 30	wb
81	Ww / 31	Wb
10	+w / 21	+b
11	-w / 21	-b
D0	=w / E0	=b
D1	!w / E1	!b
D2	<w / E2	<b
D3	>w / E3	>b
C2	cp

---------- 124

iniのENHANCEDのFM音源線形補間(bit10)での86PCMの線形補間を廃止

WSS修正
PIOモードで再生できない場合があったのを修正
PCMボリュームレベルを反映するように変更

デバッグモード数値追加検索で失敗する場合があったのを修正

iniのENHANCEDの特殊動作モード(bit16)で特定ソフトのフリーズを回避するのを追加

---------- 122

idivで例外が出るのを修正

iniのENHANCEDの特殊動作モード(bit16)で簡易グラフィックの「f2h」の状態を実機と同じになるように変更

---------- 119

プログラマブルインターバルタイマ修正

86PCM別タイプをオリジナルnp2の86PCMと同等になるように修正

BIOSの追加(int 18h)
内蔵版ファンクション45hで想定外の挙動をBIOSと同等になるように修正
ファンクション49hで想定外の挙動を実機に近くなるように修正
但しGDCの実装が厳密ではないので画面外に出た後の処理等は違います

ステートロード時のサウンドボードを反映する時にメニュー項目は維持するように変更

---------- 118

BIOSの追加(int 18h)
ファンクション45h,46hを内蔵ルーチンかBIOS内ルーチンを使って実行します
iniのENHANCEDのbit15を立てる事でBIOSを使います(BIOS.ROMが無い場合は内蔵版になります)
bit15(32768) = 0:内蔵版/1:BIOS版
VM以降のBIOSなら問題ないかと思います(EPSON版は不明)
古いソフト(8色用)の場合は新しいBIOS(16色対応)では不具合が出るかもしれません(実機でも起こる現象)
その時は内蔵ルーチン版で使用してください
BIOS版では実行速度(ウェイト処理)的なものの再現が向上します

ステートロード時にサウンドボードを反映するように変更

Disp Vsyncの時にNo Waitが効かない場合があったのを修正

---------- 117

DirectInput修正

---------- 116

NFD対応
但し必ずしも動くとは限りません

D3D時のメモリリーク修正(113～114)

---------- 114

ジョイパッド繋がっていなかった場合Device→Sound option→JoyPadの項目とジョイパッドの使用を抑制するように変更
ジョイパッドを使用する場合は繋げた状態で起動するかリセットしてください

---------- 113

D3Dの時480ライン及び画面回転がおかしかったのを修正

画面回転時Antialiaseがおかしかったのを修正

---------- 109

外部音源DLLでAMD-98の音が出なかったのを修正

マウス入力別タイプの場合カーソル移動範囲が違っていたのを修正

ウィルス誤検出対策(笑)

---------- 100

Direct3D対応(DirectX9)
メニューScreen→Window(D3D)でオンオフ
D3Dの時のStretch FilterはD3Dでの補間になります

iniのENHANCEDの旧Stretch Filterタイプ廃止
bit15(32768)は予備になります

---------- 94

EPSONモデルの時CPUがV30になっていたのを修正

---------- 89

マルチスレッド時のStretch Filter不具合修正

PSGノイズ修正

BIOSの修正(int 1bh)

デバッグモード10進入力追加(%)
%バイト数 数値で入力
%3 512 = 00 02 00
追加検索の場合は+%
+%4 65535

---------- 87

DirectInputのキーボード不具合修正

マウス入力別タイプの場合時計表示オンできなかったのを修正
Stretch Filter時の時計表示不具合修正

---------- 84

HDDがリムーブできない時があったのを修正

ステートロード時のHDDエラー表示修正

---------- 83

プログラマブルインターバルタイマ修正

---------- 78

外部音源を切り替えてリセットした時にボリューム設定が反映されなかったのを修正

---------- 75

BIOSの修正(int 18h)

CTRL+SHIFT+マウスホイールでMOUSESNS変更

---------- 74

メニューEmulate→ConfigureのArchitectureでPC-9801VMを選んだ場合強制的にCPUをLowモードにします(V30もどき)
np21/np2sxではあまり意味がありません

---------- 72

MIDI変更
Pause中の発音停止
マウスホイールで音量変化反映
他音源とのバランス調整はOSやMIDI機器側で行ってください
音量の反映やPause解除の発音のタイミングは各チャンネルのノートオン時になります

iniにBOOTSKIP追加
起動音及びメモリカウントをスキップします
bit0(1) = 0:通常/1:「ぴぽっ」スキップ
bit1(2) = 0:通常/1:メモリカウントスキップ

---------- 68

FDLをDrive3/4にも適用するように変更
それに伴いメニューリソース番号も変更になります
FDD1 44001～
FDD2 44101～
FDD3 44201～
FDD4 44301～

---------- 65

Pause追加
メニュー→Emulate→Pauseで選択します
Reset及びステート読み込みで解除されます
メニュー番号は40106です

WSS修正
多少の精度向上
フリーズするソフトの不具合修正
未対応の機能がある為ノイズしか出ない場合があります

ステートロード時のHDDエラーでSASIになっていた部分をIDEに変更

---------- 63

iniにDINPUT_K追加
DINPUT_K=trueでキー取得にDirectInputを使用します
キーマップが以下に固定されます(ほぼ自分用なので)
Scroll Lock	かな
Caps Lock	CAPS
Page Up		ROLL DOWN
Page Down	ROLL UP
この項目は自動的に作成されません(ほぼ自分用だから)

Functionを32個登録した時の不具合修正

FDD2ドライブ搭載以外の時のメニューの不具合修正

---------- 59

MIDI調整

QFM時の86PCM音質向上
iniのENHANCEDのFM音源線形補間(bit10)を86PCMの線形補間にも適用するようにします
線形補間を使用しない場合の精度も向上するようにしました

26K+86で外部音源使用時音が出なかったのを修正

起動後サウンドボードを変更した時の外部音源で音が出なかったのを修正

key dispで効果音モード使用時和音表示できるように変更
PSG部分の鍵盤表示がおかしい場合があったのを修正
26K+86で26K部分をFM3+PSG3に回帰

---------- 52

VERMOUTH選択時に起動やリセットをしたタイミングでサウンドフォントを読み込むように変更

タイトルバー修正
全体ボリュームが表示されたままだったのを修正
iniのDspClockのbit3を立てる事(+8)でタイトルバーの全体ボリューム(Vol)を非表示にします

iniのENHANCEDに特殊動作モード追加
bit16(65536) = 0:通常/1:特殊
通常では上手く動作しないものを誤魔化して実行させる特殊モードにします
将来なくなる可能性があります

---------- 49

MIDI修正

---------- 48

プログラマブルインターバルタイマ修正

---------- 46

ADPCM CPUメモリAD対応
SPB/86B+ちびおとのみ
特定ソフト用の簡易実装です

WSS修正
DAC Output Levelに対応
レジューム時に音が鳴らなくなる場合があるのを修正

デバッグモード(Unassemble)変更
OPコードも表示させるようにしました
7バイト以上の場合は+が付加されます

---------- 45

VERMOUTHのメモリリーク及び音程が変になる場合があるのを修正
レジューム時に音が変になる場合があるのは仕様です

Soft keyboardのROLL UP/DOWNが逆になっていたのを修正

---------- 43

VERMOUTH修正(QFM対応)

リソース修正
メニューのMixer(CD/MIDI)の文字のズレを修正

---------- 39

400ライン時にOdd_Lineの効果が出る場合があったのを修正

VERMOUTH音量設定追加
メニューDevice→Sound optionのMixerのCDの文字部分をクリックするとMIDIに変わり音量が変えられます
MIDIの文字部分をクリックすると再びCDに変わります
約1/2dB単位での変更になります

---------- 38

iniにM_Volume追加
マウスホイールによる全体音量記憶

カレンダ時計修正

---------- 32

Stretch Filter修正
マルチスレッド時の再描画不具合修正

iniにOdd_Line追加
200ラインモードの奇数ライン表示の操作を行います
Odd_Line = 0:通常/1:強制表示/2:強制非表示
この項目は自動的に作成されません
リセット及びportに出力した時のみ有効です

---------- 29

iniのENHANCEDに旧Stretch Filterタイプ追加
bit15(32768) = 0:新タイプ/1:旧タイプ
21以降不具合が出る環境の場合は旧タイプにしてください

FM音源修正
OPNの時にOPNAレジスタが有効になっていたのを修正

マウス別タイプ変更
ENHANCEDのbit8(512)をオリジナルnp2と同じ挙動になるように変更してデフォルトを今までの別タイプにしました
オリジナルのnp2で問題が無い場合はフラグを立ててください

---------- 25

Stretch Filter調整

---------- 21

Stretch Filter調整

---------- 19

線形補間使用時に例外が発生する場合があったのを修正

---------- 17

BIOSの修正(int 1bh)

---------- 15

ADPCM DAC対応
SPB/86B+ちびおとのみ
特定ソフト用の簡易実装です

タイトルバー変更
iniのDspClockのbit2を立てる事(+4)でタイトルバーのFDイメージファイル名を非表示にします

---------- 14

86PCMのFIFO割り込み要求修正

レジューム時FM音源の音が変になる現象を軽減

FDLのStateNameを設定した場合メニューに反映されていなかったのを修正

メニューのStat周り変更
ステートファイルをドラッグ＆ドロップした場合はステートファイメ名に絶対パスを含めるように変更(相対可の場合は相対で表示)
ステートファイルが存在しているスロットは[]表示に変更
保存読み込みしたものがわかるようにチェックを追加

---------- 7

CD音量初期化不具合修正

メニューのメモリ選択に11.6/13.6MB追加

PSGの音量デフォルトを-12に変更

---------- 5

ADPCM修正
外部音源DLL使用時のレジューム対応
音質を気が付かない程度に向上

音量バランス調整
fmgen基準なのでM88等と同等の音量になります

音量調整ダイアログをdB単位に変更
約1/2dB単位で-40～20の範囲で調整します
0がデフォルトPSGはデフォルトで-16に設定します

---------- 4

FM音源ミュート修正

---------- 2931230

PSG別タイプ/mamefmpのPSGの音量調整スライダ等での変更ですぐに反映されなかったのを修正

exeと同じフォルダ以下に存在しているスナップショットをドラッグ＆ドロップできるように変更
その場合はステートファイル名の変更はせず保存場所の変更もされません

---------- 2928601

外部音源DLLでサポートしている音源を使用する様に変更
サポートしてない音源や複数音源に対応していない場合の2枚目以降のサウンドボードは内蔵音源を使用します
AMD-98で外部音源を使用する場合はモノラル出力になります

26K+86を有効化
key displayで表示される鍵盤は26K部分がFM6音+PSG3音分表示されます

---------- 2867456

DirectSoundNotifyの分割数を4→8に変更

BIOSのエンバグ修正

---------- 2831741

マウスホイールで一画面ずつスクロールにしているとフリーズするのを修正

---------- 2832431

CPUスピード倍率動作変更
iniのCPUSMENUで-値で表記した場合100%とのトグル動作になるよう変更
CPUSMENU=100,-200,400,800,0
とした場合は現在の動作が200%時に200%を選択した場合は100%になります
メニュー項目に100%が無い場合でも100%になります

---------- 2831741

OPN(A)プリスケーラ対応(たぶん)

ADPCM修正
ADPCMの判定に失敗するソフトに対応

CPUスピード倍率追加
メニュー→Emulate→Speedで選択します
デフォルトでは50% 75% 100% 200% 400% 800%
iniにCPUSMENUを手動で追加する事で8個までカスタマイズ登録できます
8個未満の場合は0で終了を明示してください
CPUSMENU=25,50,75,100,150,200,400,800
CPUSMENU=100,200,400,800,0
あまり逸脱した値を指定選択すると動作が不安定になるので注意してください
ショートカットで使用するメニュー番号は40140～40147です

---------- 2819319

FDLにイメージ記述が無い場合の不具合修正

BIOSの修正(int 18h)

テキストRAM修正(np21)

zlibを1.2.7に変更

---------- 81834

nt版でiniの2進記述ができなかったのを修正

PAT修正
15個を超えて登録しないように修正
C1のタイマーコードを除外(リセット時にNo Codeになるので)

---------- 81802

DirectSoundNotifyの分割数を倍に変更

iniのENHANCEDにPSG別タイプ追加
bit14(16384) = 0:通常タイプ/1:別タイプ
別タイプにする事でPSGPCM等の音質が良くなるかもしれません

Window(Soft)描画タイプをWindow(Soft)/Stretch Filter描画タイプに変更
Window(Soft)での描画を別タイプにする他Stretch Filterで補間フィルタを使用しないタイプにします

---------- 81372

iniの10進数記述に2進数も扱えるように変更
先頭に「b」を記述すると2進数として扱うようになります(01でのみ判別)
例)
ENHANCED=b11011101100101
ENHANCED=b 11 0111 0110 0101
ENHANCED=b NOTIFY:1 Soft:1 86PCM:0 LINE:1 MOUSE:1 MINPUT:1 TOPMOST:0 RD:1 OW:1 S99:0 BAK:0 MTHREAD:1 TIMES:0 RAM:1

iniのENHANCEDにDirectSoundNotifyの使用追加
bit13(8192) = 0:DirectSoundNotifyを使用しない/1:DirectSoundNotifyを使用
環境によっては負荷が軽減するかもしれません
サウンドカードやデバイスドライバによってはノイズが混じるかもしれません

Antialiase高速化

PAT修正
ネットワークドライブからの読み込みに失敗する場合があったのを修正

---------- 80719

iniのENHANCEDにマウス別タイプ追加
bit8(512) = 0:通常タイプ/1:別タイプ
マウスカーソルは動くけど他の操作が出来ないような場合は別タイプにしてみてください
常時別タイプでも大部分は問題無いと思います

PAT修正
リセット時にNo Codeになるようにした(誤動作防止)
Closeを追加
スレッドセーフに

---------- 80577

PAT(PAR)機能追加
コードはP88SRの仕様に準拠但し一部命令(以下)は非対応
	50	シリアルコード
	C0	イコール比較(強化版)
	D4	キー入力比較
aabbbbに相当する部分が全てアドレスになります
メニューのPatからOpenで.PATを読み込むかドラッグ＆ドロップ
Patから実行したいコードを選択
複数のコード(最大15)を選択可能
No Codeで全コード抑制
レジュームは対象外です(FDL復帰時は読み込みのみ可能)
エミュレータの構造上CPU命令を複数実行してからPATが実行されます
例) ys3.pat
;
;	Patch for YS3 (FD)
;
#GOLD MAX
e10153b2 0000
800153b8 ffff
#EXP MAX
e10153b2 0000
800153ba ffff
#RING MAX
e10153b2 0000
300152cd 00ff
#無敵
e10153b2 0000
c20153b2 0001
300153b1 0000
例) br3.pat
;
;	Patch for Brandish 3 (FD)
;
#お金MAX
D001ED50 FFFF
8001EAFE ffff
#無敵
D001ED50 FFFF
C201ED74 0002
8001ED72 0000
例) xak3.pat
;
;	Patch for Xak 3 (FD)
;	ラトクのみ
;
#お金MAX
d003c642 4720
8003e95f ffff
#経験値MAX
d003c642 4720
8003e7e6 a885
3003e7e8 002d
#無敵
d003c642 4720
c203e7ea 0002
8003e991 0000

FDLにPAT項目追加
Pat=geso.pat

マウス入力別タイプ修正
マウスクリックで非アクティブからアクティブになった瞬間のクリックは抑制
メニュー選択時及び非アクティブ時はカーソル動作停止

デバッグウィンドウ修正
アドレス入力ダイアログボックス入力時もエミュレータの動作を抑制
マルチスレッド時の不具合修正

---------- 80496

iniのENHANCEDの音源音色切り替え方法(bit8)及びFM音源AR=0時特殊処理(bit9)を廃止
FMWait_A/Dで調整出来るのと外部音源に対しては効果が無いので

iniのENHANCEDにマウス入力別タイプ(シームレスマウス)追加
bit8(256) = 0:通常タイプ/1:別タイプ
別タイプにするとマウスモードに入らない状態でもOS側のマウスと連動してエミュレータ側のマウスが動く様になります
MOUSESNSで調整するとでOS側のマウスと同じ感覚で動かせるかもしれません
この場合OS側のマウスカーソルは表示されたままでダブルクリックは無効化されます

np21/np2sxのCPU部をXnp2(20120618)版に変更

---------- 80122

レジューム時OPNAハードウェアLFOを復帰してなかったのを修正

FDL修正
FD変更を自動感知するソフトに対応
レジューム時ツールウィンドウにも反映

CDDA再生44KHz以外のレート変換を単純変換から線形補間に変更

FM音源修正
fmgenで音が出ない場合があったのを修正
外部音源DLLで線形補間が効いていなかったのを修正
ついでに線形補間精度向上

---------- 79920

マルチスレッド修正
リセット不具合(HELP+RESET等)
気持ち程度のパフォーマンスの向上

複数ドラッグ＆ドロップ対応

スキップライン操作追加
CTRL+マウス中央ボタンでスキップラインのオンオフ
CTRL+マウスホイールでスキップラインの明るさ操作

iniのENHANCEDにWindow(Soft)の描画タイプ追加
bit12(4096) = 0:通常タイプ/1:別タイプ変更
Window(Soft)で不具合が出る場合は別タイプにしてみてください

86PCM調整

PC-9801-14修正(QFM/88KHz対応)

QFM時55KHz以外でのWAV記録が出来なかったのを修正

簡易メモリエディタ機能追加＆修正
検索値入力時&を付ける事で現在の検索結果を残したまま追加で検索
Lock時メモリ変更するとエラーになるのを修正
ダイアログボックス入力時もエミュレータの動作を抑制
デバッグウィンドウがアクティブの時にサウンドを抑制

FDL修正
OpenやEjectメニューが消えてしまうのを修正

サブウィンドウ(デバッグ以外)がアクティブ(最前面)になった時にメインウィンドウも前面になるように変更

zlibを1.2.5に変更
前の修正情報はブラフ

---------- 77012

86PCM調整

Functionショートカットを32個に変更

FDLファイル対応追加(テスト)
FDLはテキスト形式のマルチディスクイメージのリストファイルです
.fdlをドラック＆ドロップする事でメニューのFDD1/2からディスクを選択できるようになります
メニューやツールウィンドウでイメージファイルを変更した場合はFDLは解除されます
Functionショートカットに登録する事でショートカットでディスク交換も可能になります
メニュー番号はFDD1は44000～FDD2は45000～

例) SHIFT+F1～F9でFDD1/CTRL+F1～F9でFDD2のディスク交換する場合のFunction値
Function=10 70 E1 AB 10 71 E2 AB 10 72 E3 AB 10 73 E4 AB 10 74 E5 AB 10 75 E6 AB 10 76 E7 AB 10 77 E8 AB 10 78 E9 AB 10 79 EA AB 11 70 C9 AF 11 71 CA AF 11 72 CB AF 11 73 CC AF 11 74 CD AF 11 75 CE AF 11 76 CF AF 11 77 D0 AF 11 78 D1 AF 11 79 D2 AF

例) FDLファイル内容(FDイメージと同じ場所に.fdlとして保存)
;[FDLIST]以下記述
[FDLIST]
;メニューに表示するタイトル名(省略時はFDLファイル名)
Name=ワンダラーズフロムイカ娘
;ステートファイル名を変更したい場合
;StatName=geso
;ディスク番号は1～15まで番号スキップ可能
;ファイル名先頭にP,を付けるとライトプロテクト(読み込み専用)
1=P,プログラム.fdi
2=データ1.fdi
3=データ2.fdi
9=ユーザー.d88

---------- 76454

CDマウント状態記憶追加

---------- 76438

V30コア変更による不具合修正

HDD(SCSI)を認識しない場合があったのを修正

---------- 76385

np2(nt)のV30コア修正

86PCMデフォルト変更

---------- 76351

PSGPCM修正

フルスクリーン復帰時Window状態チェックが外れたままだったのを修正

---------- 76189

np21/np2sxのCPU部をXnp2(20120302)版に変更

---------- 76143

実験的に幾つかのIDEコマンドをpanicエラーから除外

デバッグモード機能追加＆修正
消費メモリ＆負荷軽減
追加検索の表示が出来なかったのを修正
Shift+↑/↓で検索にヒットしたアドレスへの前方/後方移動追加
ウィンドウタイトルにメインメモリ格納アドレス表示(他のツールでベースアドレスとして使用)
ハイメモリ(100000h以降)の書き換えは出来ません
書き換えた値を検索に含める場合は再検索してください

---------- 76110

リソースファイル名を変更
他のバージョンと混同してしまうのでnp2f_*.dllに変更しました

簡易メモリエディタ追加
iniにI286SAVE=trueを追加した時の簡易デバッガのメモリダンプで書き換え及びバイナリサーチが出来るようになります
以下の操作が追加されています
Page Up/Down	スクロール
↑/↓			スクロール(1行)
Ctrl+F			検索バイナリ入力
Ctrl+G			セグメントアドレス入力
ダブルクリック	メモリ書き換え
数値は16進数
数値部分をダブルクリックする事でメモリ書き換え(1バイト)
検索バイナリ列は1バイト～4バイト入力で複数入力時はスペースで区切りを入れてください(例:cd 1b)
入力時先頭に+を付けると以前検索して見つかった中での追加検索-を付けるか何も付けないと新規検索になります(例:+0f 27 00 00)
あくまで簡易版なので本格的な事をしたい場合は他のツールを使用してください

---------- 75772

i286を元に戻した
np2ではプロテクトモードの動作は対象外という事で

PSGPCM修正
音声が出力されない(小さい)場合があったのを修正

---------- 75438

iniのENHANCEDにタイムスタンパ＆ハードウェアウェイトフラグ追加
bit1(2)	= 0:通常/1:タイムスタンパ＆ハードウェアウェイトを明示
通常は無くても問題無いですがこのフラグを見て挙動を変える用なタイプがある場合は指定してください
実機では486以降のマシンの殆どではこのフラグが立っているので常に明示していても良いのですが弊害として実機では速いからウェイトを入れようみたいなものもここを見ている場合があるので遅くなる場合があります

---------- 75319

メニューが無いスタイルの時のリソースリーク等の修正

HSBのホットキーによるリブート時にキーが効かなくなる場合の修正

i286(loadall)修正(正しいかどうかは不明)
XMS(EMB)を使用しているようなソフトの不具合が解消されるかも
vz -z -xmでメモリ(ファイル)内容が変わってしまう等

---------- 75084

np21/np2sxのCPU部をXnp2(20120207)版に変更

86PCM調整
レジューム時に86PCMの再生が出来るようになってるかも

---------- 75018

np21/np2sxのCPU部をXnp2(20120206)版に変更

86PCM調整
それに伴いiniのENHANCEDのbit11(2048)を変更
立てる事で今までの86PCM(73066以降)互換になります

---------- 74986

np21/np2sxのCPU部をXnp2(20120205)版に変更

iniのENHANCEDに86PCM別タイプ追加
bit11(2048)	= 0:通常/1:86PCM別タイプ
86PCMを使うソフトで不具合が起こるような場合は別タイプにすると改善するかもしれません

---------- 74880,74948

86PCM調整

---------- 74836

np21/np2sxのCPU部をXnp2(20120201)版に変更
その他修正

---------- 74668

np21/np2sxのCPU部をXnp2(20120124)版に変更

---------- 74461

BIOSの修正(int 1fh/1bh)

メニューでの外部音源変更時リセットで切り替わらなかったのを修正

---------- 74216

外部音源DLLを使用する場合メモリリークが起こる場合があるのを修正

外部音源DLLメニュー選択追加
iniに何も記述していないとfmgen(built-in)
iniのFMGenDllで設定されているとfmgen(built-in)かFMGenDllで設定したDLL名
iniにDLLリストを追加する事でメニューに追加されます
FMGenDllとDLLリストは排他です(FMGenDllがあるとDLLリスト無効)
DllList?=外部音源DLL名,FMWait_A,FMWait_D,メニュー表示文字列
?は0～9の10種類(順不同スキップ可能)
外部音源DLL名を*にすると内蔵fmgenを使用します
有効ではないDLLは除外されます

例)
DllList0=*,0,0,fmgen(No Wait)
DllList1=*,80,500,fmgen(88k/QFM)
DllList2=
DllList3=mamefm.dll,180,1000,MAME(55k/QFM)
DllList4=mamefm.dll,100,680,MAME(88k/QFM)
DllList5=genpfm.dll,100,680,YM2612(88k/QFM)
;DllList7=np2fm,0,0,NP2(22/44k Only)

変更後はリセットするか次回起動時から有効になります
iniのFMWait_A/FMWait_Dは選択したリストの数値に変更されます

---------- 73066

86PCM修正

---------- 72957

CDDA周りの修正
トラック1の再生が途中で止まる/QFM使用時音が変わる等

リズムボリュームレベルを上げた(2倍)

np21でBMPが保存できなかったのを修正(たぶん)

FM音源エンジン(V1)対応
今までの仮バージョン(V0)は使用できなくなります

---------- 72207

FM音源エンジンdllでQFMが効いてない場合があったのを修正(np2fm.dll以外)

---------- 72102

FM音源エンジンdllの追加関数(CSM制御)に対応

---------- 72001

iniにFDD_Wait追加
FDDのウェイトの倍率を設定します(%単位)
100で通常150なら1.5倍になります
Seek soundの状態で処理時間が変わるので調整してください

iniにJOYSTKID追加
使用するジョイスティックのIDを設定します
0で1つ目1で2つ目に繋がってるものです(たぶん)

---------- 71984

iniのENHANCEDのbit1(2)が強制的に立っていたのを修正

Window (Soft)の方法を変更
ENHANCEDのbit1(2)を設定しなくても不具合(アイコン再描画等)が解消されたかも
それに伴いbit1は予備となります

---------- 71965

iniのENHANCEDにFM音源線形補間(QFMオフ時)追加
bit10(1024)	= 0:通常/1:線形補間を使う
今まではは常に線形補間を使用していましたが設定できるようにしました

iniにMOUSESNS追加
マウスの移動感度を設定します(デフォルトは64)
小さくすれば移動量が減り大きくすると移動量が増えます

iniにFMGenDll追加
外部FM音源エンジンdllを設定します
無設定の場合及び設定したdllが存在しない場合は内蔵のfmgenを使用します
この項目は自動的に作成されません
まだ仕様が定まっていないので今後どうなるかは不明です

---------- 71901

DirectDrawソフトウェアエミュレート廃止
Window (Soft)はWindow (Hard)のフィルタ無しで動作します(ENHANCEDのbit1)

Stretch Filter追加
メニューScreen→Stretch Filterでオンオフ
画面サイズ変更時アンチエイリアスフィルタをかけて描画します
Window (Hard)でフィルタがかからない環境用
今までの外部リソースdllではメニューが追加されないのでdllを削除するか新しいdllをダウンロードしてください
仮想マシンは対象外です

フルスクリーン時32bit以外ではAntialiaseの効果を切るように変更(非対応の為)

コンフィグのサンプリングレートに55K(Hz)追加
55Kと表示されていますが実際はiniのFMG_RATEと同値になります

マルチスレッド不具合修正

---------- 71822

ENHANCEDのbit1(2)の描画タイプをフルスクリーンでも適用するように変更
Windos (Soft)を選んだ状態からFullScreenにする事でHardフィルタ無しで描画するようになります

---------- 71774

iniにFMWait_A/FMWait_D追加
FMWait_A	OPN(A)アドレスライト後のウェイト
FMWait_D	OPN(A)データライト後のウェイト(FM音源部のみに適用)
デフォルトではどちらも0(クロック設定)

YM2608はアドレスライト後に2.1μs(約80clock)
データライト後はアドレスにより変化2.1μs～72.0μs(約80～2400clock)が必要
PSG部2.1μs/リズム部72.0μs/FM音源部5.9μs～19.4μs(最大約650clock)
例)
FMWait_A=80
FMWait_D=650
ウェイトを入れる事でFM音源レジスタにアクセスするタイミングが実機に近くなり合成の再現性が上がるかも
リリース発音中に音色切り替えしてキーオンしない場合の異音音量
(Brandish2 PROLOGE～BUNDEVIA)
リリース発音中にアタックの遅い音色をキーオンする場合のアタック開始音量
(Brandish2 Karl=cares)
リリース発音中にAR=0の音色へ切り替えた時の異音
(英雄伝説3 Heroes)
再生する周波数によっても変わるので好みで数値を調整してください

---------- 71660

zlibを1.2.5に変更

ドラッグ＆ドロップでiniを指定して起動できない不具合修正

iniのENHANCEDのbit10(1024)音合成頻度アップを廃止
効果が殆ど無いので

音合成調整(ENHANCEDの特殊設定の必要性が下がった？)

---------- 71268

マルチスレッド安定化
Key Displayを使用してる場合画面更新が行わられず演奏のみになる等
5時間程稼動テスト済

---------- 70803

iniにFunction追加
メニューをファンクション(ショートカット)キーで選択できるようにします
くわしくはFunction.txtで

---------- 70759

アプリケーションキーにメニューScreen→No Waitの機能を追加

iniのENHANCEDに音合成頻度アップを追加
bit10(1024) = 0:通常/1:頻度アップ
70017以降から常に頻度アップ状態でしたがその分メインCPU処理の頻度が下がるので設定できるようにしました

---------- 70587

マウスホイールで音量変更追加(シーク音等以外)

マルチスレッド時のステートセーブ・ロードの調整

---------- 70062

最小サウンドBuffer(ms)を40→20に変更
まともに再生できるかは不明

iniのENHANCEDにFM音源AR=0時特殊処理追加
bit9(512) = 0:通常/1:AR=0の時TL=127とする
AR=0の場合でもタイミングにより音を発音してしまう場合があるのを抑制します(英雄伝説3初期スタッフロール等)

マルチスレッド修正
安定性の向上(?)

---------- 70017

音の合成タイミング調整
アタックレート(AR)に0を含む音色に切り替えるような使い方をしている場合CPU 40MHz以下にすると異音が出る対処ができるかもしれません
ENHANCEDのbit 8でも対処できますがARを無視する実機仕様の動作も抑制されます

---------- 69808

PC-9801-999A修正
トーン交じりになる場合があったのを修正しました

スピークボードのVRに対応(今更)
単に左右それぞれの音に重みを付けて左右反転したのを元の音に加えるだけなんだけど

お試しnp2sx(nt)追加
PC-9801xSシリーズ(386SX)ライクのnp2です

---------- 69697

86/118ボードのROMEO修正

86PCM調整(暫定的)

シングルスレッド時メインウィドウがフォーカスから外れるのを修正

---------- 69664

86ボードとスピークボードをROMEOに対応(?)
環境が無い為本当に対応してるかは不明

ユーザーLPF追加
iniにlpforder(フィルタ次数)とlpfcutof(カットオフ周波数)で設定します
lpforder=0～8(0で使用しない)
lpfcutof=3000～24000(Hz)
QFMのLPFとは独立して反映されます(同時に使用可能)
それなりに重くなります

FM音源合成タイミング調整

iniのENHANCEDにFM音源音色切り替え方法追加
bit8(256) = 0:実機仕様/1:別タイプ
音色切り替え時に既にリリースが終了している場合やすぐキーオンされる場合は気になりませんがリリース中に音色切り後が休符等の場合は耳障りな音を発声する事があります
これは実機仕様ですが気になる方は別タイプにする事で抑制できます(Brandish2のOP等)
リリース中にアタックの遅い音色をキーオンするとそのアタックが無視される様な感じになるのは実機と同じ仕様ですがこれも抑制します

ステートファイルのドラッグ＆ドロップ他修正

サブウィンドウは最前面には含めないように変更

---------- 69578

iniのENHANCEDに常に最前面追加
bit7(128) = 0:通常/1;常に最前面
本当はメニューで切り替えられるようにするのがいいんだろうけど暫定処置

iniにBEEP_PCM追加
BEEP_PCM=0	通常
BEEP_PCM=2	PC-9801-999A搭載(笑)
BEEP_PCM=3	PC-9801-999A(OverDrive)搭載
BEEP_PCM=4	PC-9801-999B搭載
BEEP_PCM=5	PC-9801-999B(OverDrive)搭載
BEEPPCMを仮想拡張ボードでエミュレートします(メニューのBEEP音量を反映します)
2/3はQFM対応ですがプチノイズや意図しない音が入るかもしれません(音質は良好)
4/5はQFM非対応ですがプチノイズが軽減するかもしれません
3/5はBEEPPCMの音量を多少大きくします
必ずしもこのボードでエミュレートできるとは限らないので注意
BEEPPCMの音量を上げたい場合はBeep highよりlowやmidにして 
OverDriveにした方が音割れノイズ等少なくなります
Bufferが小さいと途切れ途切れになるかもしれません

ステートファイルをドラッグ＆ドロップするには実行ファイルと同じフォルダ以下のみを対象に修正

---------- 69513

AMD-98の不具合修正

iniにPriority追加
スレッドの優先順位値を設定します(タスクマネージャの優先度の設定と同機能)
Priority=0	通常
Priority=1	通常以上
Priority=2	高
通常以上にする事でエミュレートの実行精度が上がるかもしれません
但しあまり高くすると他の処理に影響が出るので注意してください(不安定になったり)
マルチスレッド時はエミュレートスレッドのみ作用します

---------- 69497

ステートファイルのドラッグ＆ドロップ対応
.s99の場合は上書き確認及び.bakを作らないように変更

---------- 69467

iniのENHANCEDの別描画タイプの時の動作を変更
Window(Soft)をWindow(Hard)のフィルタ無し描画に変更になります

iniのSampleHzを自由表記できるように変更
但しあまり逸脱した数値を設定すると不具合が出るかもしれません
(内部的には25で割り切れる値が好ましい)
コンフィグでは
44100未満(11025等)の場合は22KHz
88200未満(55466等)の場合は44KHz
88200以上(96000等)の場合は88KHz
が選択されます

ステートファイル名の変更を追加
メニューStatの一番上(初回時は[No title])を選択する事でダイアログが開くので
好きな名前を入力してください
nekoと入力した場合neko.S??としてステートファイルを扱います
裏技としてfolder\nekoとする事でfolder内にneko.S??としてセーブする事が可能です
但し事前にそのフォルダが存在していないといけません
レジュームは対象外です

---------- 69320

nt版のhostdrv不具合修正

マルチスレッド時Background soundが無視されていたのを修正

---------- 69243

マルチスレッド時のステートセーブ・ロードの不具合修正

iniのENHANCEDにステートファイル(.s??)関係の設定追加
bit3( 8) = 0:通常/1:上書きする場合元ファイルを.bakにする
bit4(16) = 0:通常/1:読み込み前に現在のステートを.s99として保存する
bit5(32) = 0:通常/1:上書き確認する
bit6(64) = 0:通常/1:読み込み確認する
.bakはロードしようと思って間違って上書きセーブしてしまった時の対処
.s99はセーブしようと思って間違ってロードしてしまった時の対処

---------- 69170

レジューム警告ダイアログキャンセル終了時リソース・メモリリークしていたのを修正
大概プロセス終了時にOS側で破棄されるのでそれほど気にする事は無いですけど

iniのENHANCEDに
描画タイプ
bit1(2) = 0:通常タイプ/1:別タイプ
マルチスレッド
bit2(4) = 0:シングルスレッド/1:マルチスレッド
を追加
ENHANCED=2で別タイプの描画
ENHANCED=4でマルチスレッド
(メモリ強制RAMモードと合わせて全て使用する場合はENHANCED=7とする)
描画タイプを別タイプにすると
DirectDraw(Hard)を使用しても拡大時にフィルタがかからないようにします
DirectDraw(Soft)があるので意味は無いかもしれませんが一部環境でSoftを使うとあまり好ましくない現象が起こる場合があった為(デスクトップアイコン再描画が頻発したり)
環境によってはきちんと描画されなくなる場合もあるので注意
マルチスレッドにすると
利点としては他のウインドウを移動する程度の事をしてもシングルスレッドでは音楽再生等瞬間停止する感じがしますがこの手の問題が解消されます
欠点としてはメニューを開いていてもエミュレート実行は中断されません
無理やり実装しているので不安定になところがあるかもしれません
描画スレッド及びサウンドスレッドは殆ど効果が無かったので保留中

---------- 68775

ドラッグ＆ドロップで.imgを除外

おまけでiniにENHANCEDを追加(危険なので取り扱い注意)
bit0(1) = 0:通常モード/1:メモリ強制RAMモード
ENHANCED=1で通常書き込めないメモリも書き込めるようにします
但しEPSONモデルはいろいろ柵で難しいかも(I/Oの43fh等)
NECモデルの場合はd0000～fffffが書き込み可能になります
使い方を間違えると最悪クラッシュするかもしれません(自己責任で)
UMB使用例(これが安全というわけではありません)
A500-A7FF
C000-CFFF	(EMS未使用時)
D100-DFFF	(21の場合は不明)
E800-F3FF	(BASICを使わない場合)

---------- 68624

イメージファイルのドラッグ＆ドロップ追加
.hdi|.thd|.nhd(HDイメージ)の場合はIDE #0(Ctrlを押しながらでIDE #1)
.cue|.ccd|.cdm|.mds|.nrg|.iso(CDイメージ)はIDE #2
.hdd(HDイメージ)の場合はSCSI #0(Ctrlを押しながらでSCSI #1)
.d88|.88d|.d98|.98d|.fdi|.xdf|.hdm|.dup|.2hd|.tfd(FDイメージ)の場合はFDD1(Ctrlを押しながらでFDD2)
でOpenしたのと同じになります
複数ドロップ不可

---------- 68470

アンチエイリアス時に画面回転すると描画されないのを修正
ついでに左回転時にエラーで落ちるバグ修正

---------- 68437

アンチエイリアスにLight追加
順番がずれるので今まで設定していた場合は一旦解除してください

レジューム時に拡張音源部がマスクされてたのを修正

---------- 68380

a5000-a7fffのメモリを書き込み可能に変更
EPSON機種選択していればd4000-dffffと合わせてUMBを60KB確保できます

アンチエイリアス追加
メニューScreen→Antialiase(Soft/Hard)で選択
但し要MMX/画面モード32bitの条件でのみ使用可能
フルクリーン時は32bitにならない環境は不可
メニューのScreen→Screen Option→FullScreen→No change screen colorsをオンにすると32bitのままフルスクリーンにできるかも

その他修正

---------- 68036

メニューDevice→Sound optionのMixerにCDを追加
64がデフォルトあまり大きくすると音割れするかも
np21のia32を0.82版に変更(emm386.exe等が使用可能)
QFMではない時LPFルーチンを使わないように修正
(効果が無いのとLPFを使用しなくてもルーチンを使うとノイズが乗るので)

---------- 67404

終了ダイアログの不具合修正

---------- 65104

QFMとLPFが終了時に保存されない場合があったのを修正
LPFが起動時に反映されていなかったのを修正

QFMではない時のFM音源の再現向上
一部音色はまだ厳しいですが今までよりノイズが軽減されています
音が気にならなければQFMを切る方がいいかも(他の音源にあまり影響を及ぼさないので)
おすすめは44KHz+LPF+QFMか88KHz+LPFです
QFMでない時のLPFはそれほど効果がありません(高音時ノイズがあまり発生しない為)

---------- 65058

LPFの使用選択及びFM音源重視(QFM)の使用選択追加(65035参照)
メニューEmulate→Configureで選択
リセットするか次回起動時から有効になります(LPF切り替えは即反映)

組み合わせで好みなのを選んでください

例)
88KHz+LPF+QFM
	FM音源の再現はそこそこ綺麗
	BEEPPCM等の音はよくない
	タイミングに問題
44KHz+LPF+QFM
	FM音源の再現は88KHz程ではないがさほど遜色は無い
	BEEPPCM等の音はよくない
	タイミングはまぁまぁ
88KHz+LPF
	一部のFM音源の再現はあまりよくない
	BEEPPCM等の音はそれなり
	タイミングはまぁまぁ

---------- 65035

FM音源再現向上(QFM)
一部音色でノイジーになるのを軽減
但しタイミングに依存しているようなものは犠牲になる可能性があります(BEEPPCM等)
FM音源自体でもタイマーによるタイミングに依存しているので
CSMやエンベロープ再現に支障が出る場合があります

---------- 65028

FM音源調整

---------- 65011

np21(nt)のレジューム修正

---------- 64961

M88と同じLPF方式追加
これは一部音源(FDDシーク音等)を除いて全体に適用されます

本体がアクティブ(最前面)になった時にサブウィンドウも前面になるように変更

---------- 64918

FM音源線形補間追加

ソフトキーボードのメニューオンオフ及び表示状態記憶追加

---------- 64858

サンプリングレートを11025Hz→88200Hzに変更
但し補間やフィルタは使用していないので
FM音源は55466Hzで再生されるのと同じになります
裏技でFMG_RATEを88200Hz以上にして記述すれば
高レートで合成して88200Hzに変換して再生さるので
音質向上に多少効果があるかもしれません(音の再現性は低いかも)

---------- 64802

iniにOPNA_CLK(OPNAクロック)とFMG_RATE(fmgen合成レート)追加
[NekoProjectII]又は[NekoProject21]に記述する事で変更可能
記述無し又はデフォルトでは
OPNA_CLK=7987200
FMG_RATE=55466

---------- 64711

音質改善(CSM含む)

---------- 64690

118音源修正

---------- 64674,5

OPNAクロックを7987104→7987200に変更
fmgenを新しいものに変更
効果音モード修正

---------- 64672

fmgenで一部の音がおかしくなるのを修正
fmgen合成レートを55466Hzに変更
FM音源の初期音量を多少アップ(iniのVolume_Fが72位がちょうど良いかも)
画面サイズ記録を追加

---------- 64668

画面関係設定記録を追加
FM音源部のみfmgen(Copyright (C) by cisc)に変更(PSG/ADPCM/RYHTHMは変更していません)

無保証です
何か問題が起きても責任は負いません
自己判断で使用してください
非公式ビルドなので本家の方々への問い合わせはご遠慮ください
自分で使用するものをよければどうぞみたいな感じなので期待しないでください
